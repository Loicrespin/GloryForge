<form>
    {{#unless isGM}}
    <h2 class="title">Mes TrophÃ©es</h2>
    <div class="trophy-grid">
        {{#each trophies}}
            {{#if (includes this.awardedTo ../userId)}}
                <div class="trophy {{this.grade}}">
                    <img src="{{this.image}}" alt="{{this.title}}" />
                    <h3>{{this.title}}</h3>
                    <p>{{this.description}}</p>
                    <span class="grade">{{this.grade}}</span>
                </div>
            {{/if}}
        {{/each}}
    </div>
{{/unless}}

    {{#if isGM}}
        <h2>Ajouter un trophÃ©e</h2>
        <div class="form-group">
            <label for="trophy-title">Titre :</label>
            <input type="text" id="trophy-title" placeholder="Nom du trophÃ©e">
        </div>
        <div class="form-group">
            <label for="trophy-description">Description :</label>
            <textarea id="trophy-description" placeholder="Description du trophÃ©e"></textarea>
        </div>
        <div class="form-group">
            <label for="trophy-image">Image (URL) :</label>
            <input type="text" id="trophy-image" placeholder="URL de l'image">
        </div>
        <div class="form-group">
            <label for="trophy-grade">Grade :</label>
            <select id="trophy-grade">
                <option value="Bronze">Bronze</option>
                <option value="Argent">Argent</option>
                <option value="Or">Or</option>
                <option value="Platine">Platine</option>
            </select>
        </div>
        <div class="form-group checkbox-group">
            <input type="checkbox" id="trophy-hidden">
            <label for="trophy-hidden">TrophÃ©e cachÃ©</label>
        </div>
        <div class="form-group checkbox-group">
            <input type="checkbox" id="trophy-hide-description">
            <label for="trophy-hide-description">Cacher la description</label>
        </div>
            
        <button id="add-trophy-btn">Ajouter</button>
    {{/if}}

    <h2 class="title">Liste des TrophÃ©es</h2>
    {{#if ../isGM}}
    <h3>Attribuer un trophÃ©e Ã  un joueur</h3>
    <div class="form-group">
        <label for="award-player">SÃ©lectionner un joueur :</label>
        <select id="award-player">
            {{#each game.users as |user|}}
                {{#if user.active}}
                    <option value="{{user.id}}">{{user.name}}</option>
                {{/if}}
            {{/each}}
        </select>
    </div>
    <button class="award-trophy-btn" data-id="{{this.id}}">Attribuer</button>
{{/if}}

    <div class="trophy-grid">
        {{#each trophies}}
    <div class="trophy {{this.grade}} {{#if this.hidden}}hidden-trophy{{/if}}">
        <img src="{{this.image}}" alt="{{this.title}}" class="{{#if this.hidden}}blurred{{/if}}" />
        
        <h3 class="{{#if this.hidden}}gm-visible{{/if}}">
            {{#if ../isGM}}
                {{this.title}}
                {{#if this.hidden}} <span class="hidden-label">ðŸ”’ CachÃ©</span> {{/if}}
            {{else}}
                {{#if this.hidden}}
                    <i>ðŸ”’ CachÃ©</i>
                {{else}}
                    {{this.title}}
                {{/if}}
            {{/if}}
        </h3>

        <p class="{{#if this.hidden}}gm-visible{{/if}}">
            {{#if ../isGM}}
                {{this.description}}
                {{#if this.hidden}}
                    <span class="hidden-label">ðŸ”’ CachÃ© pour les joueurs</span>
                {{/if}}
                {{#if this.hideDescription}}
                    <span class="hidden-label-description">ðŸ“œ Description masquÃ©e</span>
                {{/if}}
            {{else}}
                {{#if this.hidden}}
                    <i>ðŸ”’ Ce trophÃ©e est cachÃ©</i>
                {{else}}
                    {{#if this.hideDescription}}
                        <i>ðŸ”’ Description cachÃ©e</i>
                    {{else}}
                        {{this.description}}
                    {{/if}}
                {{/if}}
            {{/if}}
        </p>

        <span class="grade">{{this.grade}}</span>

        {{#if ../isGM}}
            <button class="delete-trophy-btn" data-id="{{this.id}}">Supprimer</button>

            <!-- Attribution des trophÃ©es aux joueurs -->
            <h4>Attribuer Ã  un joueur</h4>
            <div class="form-group">
                <label for="award-player-{{this.id}}">SÃ©lectionner un joueur :</label>
                <select id="award-player-{{this.id}}">
                    {{#each ../users}}
                        <option value="{{this.id}}">{{this.name}}</option>
                    {{/each}}
                </select>
            </div>
            <button class="award-trophy-btn" data-id="{{this.id}}">Attribuer</button>
            
        {{/if}}

        {{#if ../isGM}}
        {{#if this.awardedToNames.length}}
            <p class="awarded-players">DÃ©bloquÃ© par :
                {{#each this.awardedToNames}}
                    {{this}}  
                {{/each}}
            </p>
        {{else}}
            <p class="awarded-players">Aucun joueur n'a encore dÃ©bloquÃ© ce trophÃ©e.</p>
        {{/if}}
    {{/if}}
    </div>
{{/each}}
